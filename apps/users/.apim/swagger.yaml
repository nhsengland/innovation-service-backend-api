info:
  title: Users API @ NHS Innovation Service
  version: 1.0.0
servers:
  - url: https://nhse-${ENV}-innovation-service-user-functions.azurewebsites.net/api
openapi: 3.0.3
paths:
  /v1/email-preferences:
    get:
      description: Returns the user email notifications preferences
      operationId: v1-email-notification-preferences-info
      tags:
        - "[v1] Email Preferences"
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    notificationType:
                      type: string
                      description: The type of notification
                      enum:
                        - ACTION
                        - MESSAGE
                        - SUPPORT
                    preference:
                      type: string
                      description: The preference of the notification
                      enum:
                        - NEVER
                        - INSTANTLY
                        - DAILY
    put:
      description: "Updates the user email preferences "
      operationId: v1-email-notification-preferences-upsert
      tags:
        - "[v1] Email Preferences"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  notificationType:
                    type: string
                    enum:
                      - ACTION
                      - MESSAGE
                      - SUPPORT
                  preference:
                    type: string
                    enum:
                      - NEVER
                      - INSTANTLY
                      - DAILY
                required:
                  - notificationType
                  - preference
                additionalProperties: false
              minItems: 1
      responses:
        "204":
          description: The user email preferences were updated successfully
  /v1/invites:
    get:
      description: Get collaboration invites list
      operationId: v1-invites-list
      parameters: []
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
  /v1/me:
    post:
      summary: Create a new user on DB
      operationId: v1-me-create
      tags:
        - "[v1] Users"
      responses:
        "200":
          description: User created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
    get:
      description: Retrieves the user profile information.
      operationId: v1-me-info
      tags:
        - "[v1] Users"
      parameters: []
      responses:
        "200":
          description: Successful operation
        "404":
          description: Not found
    put:
      description: User profile information update
      operationId: v1-me-update
      tags:
        - "[v1] Users"
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                displayName:
                  type: string
                  description: The display name of the user
                  example: John Doe
                mobilePhone:
                  type: string
                  description: The mobile phone number of the user
                  example: "07777777777"
                organisation:
                  type: object
                  properties:
                    id:
                      type: string
                      description: The ID of the organisation
                      example: 12345678-1234-1234-1234-123456789012
                    name:
                      type: string
                      description: The name of the organisation
                      example: Example Organisation
                    isShadow:
                      type: boolean
                      description: Whether the organisation is a shadow organisation
                      example: false
                    size:
                      type: string
                      description: The size of the organisation
                      example: small
      responses:
        "200":
          description: User information updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
  /v1/me/delete:
    patch:
      description: User delete
      operationId: v1-me-delete
      tags:
        - "[v1] Users"
      parameters: []
      requestBody:
        description: Reason for deletion
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  maxLength: 2000
              required:
                - reason
              additionalProperties: false
      responses:
        "200":
          description: User deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
        "400":
          description: Bad request.
  /v1/me/terms-of-use/accept:
    patch:
      description: Accept user terms of use
      operationId: v1-me-terms-of-use-accept
      tags:
        - "[v1] Terms of Use"
      parameters: []
      responses:
        "200":
          description: Successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: Operation identifier
        "422":
          description: Unprocessable Entity
  /v1/me/terms-of-use:
    get:
      description: Retrieves the user terms of use
      operationId: v1-me-terms-of-use-info
      tags:
        - "[v1] Terms of Use"
      parameters: []
      responses:
        "200":
          description: Successful operation
        "404":
          description: Terms of use not found
  /v1/notifications/counters:
    get:
      description: Returns the notifications counters
      operationId: v1-notifications-counters
      tags:
        - "[v1] Notifications"
      parameters: []
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: number
                    description: The total of active notifications
  "/v1/notifications/{notificationId}":
    delete:
      description: Returns the id of the deleted notification
      operationId: v1-notifications-delete
      tags:
        - "[v1] Notifications"
      parameters:
        - name: notificationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
            description: The notification ID
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: The notification id
  /v1/notifications/dismiss:
    patch:
      description: Returns the number of affected notifications
      operationId: v1-notifications-dismiss
      tags:
        - "[v1] Notifications"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                notificationIds:
                  type: array
                  items:
                    type: string
                    format: uuid
                  description: The notification IDs
                  default: []
                contextIds:
                  type: array
                  items:
                    type: string
                    format: uuid
                  description: The context IDs
                  default: []
                contextTypes:
                  type: array
                  items:
                    type: string
                    enum:
                      - NEEDS_ASSESSMENT
                      - INNOVATION
                      - SUPPORT
                      - ACTION
                      - THREAD
                      - COMMENT
                  description: The context types
                  default: []
                dismissAll:
                  type: boolean
                  description: Dismiss all notifications
                  default: false
              additionalProperties: false
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  affected:
                    type: number
                    description: The number of affected notifications
  /v1/notifications:
    get:
      description: Returns the user notifications
      operationId: v1-notifications-list
      tags:
        - "[v1] Notifications"
      parameters:
        - name: skip
          in: query
          required: false
          schema:
            type: number
            format: float
        - name: take
          in: query
          required: false
          schema:
            type: number
            format: float
            maximum: 100
            default: 20
        - name: order
          in: query
          required: false
          schema:
            type: object
            properties: {}
            additionalProperties:
              type: string
              enum:
                - ASC
                - DESC
            default:
              default: DESC
        - name: contextTypes
          in: query
          required: false
          schema:
            type: array
            items:
              type: string
              enum:
                - ""
                - NEEDS_ASSESSMENT
                - INNOVATION
                - SUPPORT
                - ACTION
                - THREAD
                - COMMENT
            description: The context types to filter by
            default: []
        - name: unreadOnly
          in: query
          required: false
          schema:
            type: boolean
            description: If true, only returns the unread notifications
            default: false
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: number
                    description: The total number of notifications
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                          description: The notification ID
                        innovation:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                              description: The innovation ID
                            name:
                              type: string
                              description: The innovation name
                            status:
                              type: string
                              enum:
                                - CREATED
                                - WAITING_NEEDS_ASSESSMENT
                                - NEEDS_ASSESSMENT
                                - IN_PROGRESS
                                - WITHDRAWN
                                - COMPLETE
                                - PAUSED
                              description: The innovation status
                        contextType:
                          type: string
                          enum:
                            - NEEDS_ASSESSMENT
                            - INNOVATION
                            - SUPPORT
                            - ACTION
                            - THREAD
                            - COMMENT
                          description: The notification context type
                        contextDetail:
                          type: string
                          enum:
                            - LOCK_USER
                            - THREAD_CREATION
                            - THREAD_MESSAGE_CREATION
                            - COMMENT_CREATION
                            - COMMENT_REPLY
                            - ACTION_CREATION
                            - ACTION_UPDATE
                            - NEEDS_ASSESSMENT_COMPLETED
                            - NEEDS_ASSESSMENT_ORGANISATION_SUGGESTION
                            - INNOVATION_SUBMISSION
                            - SUPPORT_STATUS_UPDATE
                            - INNOVATION_REASSESSMENT_REQUEST
                            - INNOVATION_STOP_SHARING
                            - COLLABORATOR_INVITE
                            - COLLABORATOR_UPDATE
                          description: The notification context detail
                        contextId:
                          type: string
                          description: The notification context ID
                        createdAt:
                          type: string
                          format: date-time
                          description: The notification creation date
                        readAt:
                          type: string
                          format: date-time
                          description: The notification read date
                        params:
                          type: object
                          description: The notification params
  "/v1/organisations/{organisationId}":
    get:
      description: Get organisation info.
      operationId: v1-organisation-info
      parameters:
        - name: organisationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Success.
        "400":
          description: Bad request.
        "401":
          description: The user is not authorized to get this information.
        "500":
          description: An error occurred while getting this information.
  "/v1/organisations/{organisationId}/units/{organisationUnitId}":
    get:
      description: Get organisation unitinfo.
      operationId: v1-organisation-unit-info
      parameters:
        - name: organisationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: organisationUnitId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Success.
        "400":
          description: Bad request.
        "401":
          description: The user is not authorized to get this information.
        "500":
          description: An error occurred while getting this information.
  /v1/organisations:
    get:
      description: Retrieves organisations list
      operationId: v1-organisations-list
      tags:
        - "[v1] Organisations"
      parameters: []
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
  /v1/survey:
    post:
      operationId: v1-survey-create
      description: Creates a Survey object with answers
      tags:
        - "[v1] Survey"
      parameters: []
      responses:
        "200":
          description: Successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: Unique identifier for survey object
        "400":
          description: Invalid survey payload
  /v1:
    head:
      operationId: v1-users-email-available
      description: Check if email is available for a new user.
      tags:
        - "[v1] Users"
      parameters:
        - name: email
          in: query
          required: true
          schema:
            type: string
            format: email
            description: Email of a user.
      responses:
        "200":
          description: Email is already in use.
        "404":
          description: Email is available.
    get:
      operationId: v1-users-list
      description: Get users list
      tags:
        - "[v1] Users"
      parameters: []
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: Unique identifier for user object
  "/v1/{userId}":
    get:
      operationId: v1-users-info
      description: Get user info
      tags:
        - "[v1] Users"
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
            description: The user ID
        - name: model
          in: query
          required: false
          schema:
            type: string
            enum:
              - minimal
              - full
            description: The model to use for the response
            default: minimal
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: Unique identifier for user object
        "403":
          description: Forbidden
  /v1/statistics:
    get:
      description: Get an user statistics
      operationId: v1-users-statistics
      tags:
        - "[v1] User Statistics"
      parameters:
        - in: query
          name: statistics
          required: false
          schema:
            type: string
            enum:
              - WAITING_ASSESSMENT_COUNTER
              - ASSIGNED_INNOVATIONS_COUNTER
              - INNOVATIONS_ASSIGNED_TO_ME_COUNTER
              - ACTIONS_TO_REVIEW_COUNTER
              - INNOVATIONS_TO_REVIEW_COUNTER
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                type: object
